# 编辑器与 AI 助手集成功能测试清单

## 测试前准备

1. 启动项目：`./start.sh`
2. 登录或创建账号
3. 打开浏览器开发者工具（Console），查看日志

---

## 测试用例

### ✅ 模块 1：思维导图编辑器节点选择

#### TC-MM-01: 单个节点选择
**步骤：**
1. 创建或打开一个思维导图笔记
2. 点击选中一个节点
3. 观察工具栏按钮状态

**预期结果：**
- 工具栏显示"发送 1 个节点"按钮
- 按钮处于可点击状态（primary 样式）

#### TC-MM-02: 多个节点选择
**步骤：**
1. 按住 Shift 键，点击选中多个节点
2. 观察工具栏按钮状态变化

**预期结果：**
- 按钮文字动态更新为"发送 N 个节点"
- 显示正确的节点数量

#### TC-MM-03: 发送到 AI 助手
**步骤：**
1. 选中 3 个节点
2. 点击"发送到 AI 助手"按钮
3. 观察 AI 助手侧边栏

**预期结果：**
- 显示成功提示："已将 3 个节点添加到 AI 助手"
- AI 助手输入框显示选择内容指示器
- 显示节点层级结构（带缩进）
- 显示清除按钮

#### TC-MM-04: 选择内容格式验证
**步骤：**
1. 选中包含多层级的节点
2. 发送到 AI 助手
3. 检查内容格式

**预期结果：**
```
📍 中心主题
  ├─ 子主题 1
  │   └─ 子主题 1.1
  └─ 子主题 2
```
- 层级关系正确显示
- 缩进格式正确

#### TC-MM-05: 清除选择
**步骤：**
1. 选中节点并发送到 AI
2. 点击 AI 助手的"清除"按钮
3. 观察状态

**预期结果：**
- 选择内容指示器消失
- 可以重新选择其他节点

---

### ✅ 模块 2：文本编辑器选择（Markdown/富文本/Monaco）

#### TC-TX-01: Markdown 文本选择
**步骤：**
1. 打开一个 Markdown 笔记
2. 鼠标选中一段文字
3. 观察 AI 助手输入框

**预期结果：**
- 自动显示选择内容指示器
- 显示"已选择 Markdown 内容: ..."
- 如果文本 >50 字符，显示预览

#### TC-TX-02: 富文本编辑器选择
**步骤：**
1. 打开一个富文本笔记
2. 选中带有格式的文字（粗体、斜体等）
3. 检查发送到 AI 的内容

**预期结果：**
- 纯文本内容（不包含 HTML 标签）
- 内容格式正确

#### TC-TX-03: Monaco 代码选择
**步骤：**
1. 打开一个代码笔记（Monaco 编辑器）
2. 选中一段代码
3. 发送到 AI 助手

**预期结果：**
- 代码格式保留
- 显示来源为"代码"

#### TC-TX-04: 长文本截断
**步骤：**
1. 选中超过 2000 字符的长文本
2. 检查是否被截断

**预期结果：**
- 文本被截断到配置的长度
- 末尾显示"...(内容过长，已截断)"

---

### ✅ 模块 3：DrawIO 编辑器元素选择

#### TC-DR-01: 单个元素选择
**步骤：**
1. 打开一个 DrawIO 笔记
2. 点击选中一个图形元素
3. 观察工具栏

**预期结果：**
- 显示"发送 1 个元素"按钮
- 按钮可点击

#### TC-DR-02: 多个元素选择
**步骤：**
1. 拖拽框选多个元素
2. 观察按钮状态

**预期结果：**
- 显示正确的元素数量
- 按钮高亮

#### TC-DR-03: 发送到 AI
**步骤：**
1. 选中 2-3 个元素
2. 点击发送按钮
3. 观察 AI 助手

**预期结果：**
- 显示成功提示
- 内容格式为：
  ```
  [1] 元素标签 (类型)
  [2] 元素标签 (类型)
  ```

#### TC-DR-04: iframe 通信
**步骤：**
1. 打开浏览器 Console
2. 在 DrawIO 中选择元素并点击发送
3. 查看日志

**预期结果：**
- 看到 `[DrawIO] Selected elements: N` 日志
- 通信正常，无错误

---

### ✅ 模块 4：AI 助手交互

#### TC-AI-01: 选择内容显示
**步骤：**
1. 从任意编辑器发送内容到 AI
2. 观察 AI 助手输入框上方

**预期结果：**
```
┌─────────────────────────────────────────┐
│ 📋 已选择 3 个思维导图节点        [清除]│
│ ┌─────────────────────────────────────┐│
│ │ 📍 中心主题                          ││
│ │   ├─ 子主题 1                       ││
│ │   └─ 子主题 2                       ││
│ └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

#### TC-AI-02: 发送消息
**步骤：**
1. 有选择内容时，输入问题
2. 点击发送按钮
3. 观察 AI 响应

**预期结果：**
- 消息包含选择内容
- AI 理解并正确回答

#### TC-AI-03: 自动清除选择
**步骤：**
1. 发送带有选择内容的消息
2. 检查发送后状态

**预期结果：**
- 如果设置中开启"发送后自动清除"
- 选择内容指示器自动消失

---

### ✅ 模块 5：用户配置设置

#### TC-SET-01: 打开设置面板
**步骤：**
1. 打开 AI 助手侧边栏
2. 点击工具栏的 ⚙️ 设置图标
3. 观察弹窗

**预期结果：**
- 设置面板正常打开
- 显示所有配置项

#### TC-SET-02: 修改发送模式
**步骤：**
1. 切换到"JSON 模式"
2. 点击"完成"
3. 重新发送内容

**预期结果：**
- 发送的消息包含完整的 JSON 数据
- AI 可以访问原始数据结构

#### TC-SET-03: 调整节点数量限制
**步骤：**
1. 将"最大节点数量"调整为 5
2. 尝试发送 10 个节点
3. 检查是否被限制

**预期结果：**
- 提示节点数量超限
- 或自动截断到 5 个节点

#### TC-SET-04: 调整文本长度限制
**步骤：**
1. 将"最大文本长度"调整为 500
2. 选择 1000 字符的文本
3. 检查是否被截断

**预期结果：**
- 文本被截断到 500 字符
- 显示截断提示

#### TC-SET-05: 关闭预览
**步骤：**
1. 关闭"显示预览"开关
2. 发送内容到 AI
3. 检查输入框

**预期结果：**
- 只显示描述行
- 不显示内容预览

#### TC-SET-06: 设置持久化
**步骤：**
1. 修改配置项
2. 刷新页面
3. 重新打开设置面板

**预期结果：**
- 配置保持不变
- 持久化成功

---

### ✅ 模块 6：边界条件和异常

#### TC-BR-01: 超大节点数量
**步骤：**
1. 选中 50+ 个节点
2. 尝试发送

**预期结果：**
- 显示警告或截断
- 不会导致页面卡死

#### TC-BR-02: 空选择
**步骤：**
1. 不选择任何内容
2. 点击发送按钮（如果启用）

**预期结果：**
- 显示"请先选中内容"提示
- 不会发送空消息

#### TC-BR-03: 快速连续选择
**步骤：**
1. 快速选择不同内容
2. 观察状态更新

**预期结果：**
- 状态正确更新
- 无错误或冲突

#### TC-BR-04: 网络断开
**步骤：**
1. 断开网络
2. 发送内容到 AI
3. 观察错误处理

**预期结果：**
- 显示网络错误提示
- 不会崩溃

---

## 性能测试

### TC-PERF-01: 大量节点
- **测试**：选择 50 个节点
- **预期**：响应时间 < 500ms

### TC-PERF-02: 长文本
- **测试**：选择 5000 字符文本
- **预期**：处理时间 < 200ms

### TC-PERF-03: 频繁操作
- **测试**：连续选择和清除 50 次
- **预期**：无内存泄漏

---

## 兼容性测试

| 浏览器 | 版本 | 状态 |
|--------|------|------|
| Chrome | 最新 | ✅ |
| Firefox | 最新 | ✅ |
| Safari | 最新 | ⚠️ 需测试 |
| Edge | 最新 | ✅ |

---

## 测试报告模板

```
测试日期：__________
测试人员：__________
浏览器版本：__________

✅ 通过用例：_____ / _____
❌ 失败用例：_____ / _____
⚠️  阻塞问题：_____

问题记录：
1.
2.
3.

建议改进：
1.
2.
3.
```

---

## 快速回归测试（每次修改后执行）

- [ ] 思维导图：选中节点 → 发送 → AI 接收
- [ ] Markdown：选中文本 → AI 自动显示
- [ ] DrawIO：选中元素 → 发送 → AI 接收
- [ ] 设置：修改配置 → 刷新 → 保持不变
- [ ] 清除：点击清除 → 状态重置
