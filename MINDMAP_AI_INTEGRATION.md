# 思维导图 AI 助手集成说明

## 📋 功能概述

思维导图 AI 助手是 AiNote 的一个内置 AI 助手,专门用于思维导图的编辑、优化和生成。通过与 AI 助手对话,您可以快速创建、修改和优化思维导图结构。

## ✨ 核心功能

### 1. 自动切换助手
当您打开思维导图类型的笔记时,AI 助手会自动切换到"思维导图助手",提供专业的思维导图编辑功能。

### 2. 发送数据到 AI 助手
在思维导图编辑器中选中节点后,点击"发送到 AI 助手"按钮,系统会:
- 发送完整的思维导图 JSON 数据
- 发送选中的节点数据
- 在 AI 助手中显示结构化的节点信息

### 3. AI 生成和修改
AI 助手可以:
- 从零开始创建思维导图
- 添加、删除、重组节点
- 优化节点内容和结构
- 调整层级关系
- 扩展或精简内容

### 4. 从 AI 导入
点击"从 AI 导入"按钮,系统会:
- 从 AI 助手的最新响应中提取思维导图 JSON
- 验证 JSON 格式和结构
- 自动加载到思维导图编辑器
- 保存到当前笔记

## 🚀 使用流程

### 场景 1: 从零创建思维导图

```
1. 创建新的思维导图笔记
2. 在 AI 助手中输入需求
   例如: "帮我创建一个关于 AI 学习路径的思维导图"
3. AI 生成思维导图 JSON
4. 点击"从 AI 导入"按钮
5. 思维导图自动加载到编辑器
```

### 场景 2: 优化现有思维导图

```
1. 打开已有的思维导图
2. 选中需要优化的节点
3. 点击"发送到 AI 助手"
4. 在 AI 助手中描述优化需求
   例如: "请帮我扩展这些节点,添加更多细节"
5. AI 生成修改后的 JSON
6. 点击"从 AI 导入"按钮
7. 思维导图自动更新
```

### 场景 3: 重组结构

```
1. 打开思维导图
2. 选中需要重组的节点
3. 发送到 AI 助手
4. 描述重组需求
   例如: "请将这些节点按优先级重新排序"
5. 从 AI 导入修改后的结构
```

## 💬 AI 对话示例

### 示例 1: 创建项目管理思维导图

```
用户: 帮我创建一个软件项目管理的思维导图

AI: 我为您创建了一个完整的软件项目管理思维导图,包含以下主要部分:

\`\`\`json
{
  "data": {
    "text": "软件项目管理",
    "children": [
      {
        "data": {
          "text": "需求分析",
          "children": [...]
        }
      },
      ...
    ]
  }
}
\`\`\`

包含需求分析、设计、开发、测试、部署等核心阶段。
```

### 示例 2: 扩展节点

```
用户: 请为"需求分析"添加更多子节点

AI: 我为"需求分析"添加了以下子节点:

1. 用户调研
2. 竞品分析
3. 功能定义
4. 需求评审
5. 需求文档

\`\`\`json
{
  "data": {
    "text": "软件项目管理",
    "children": [
      {
        "data": {
          "text": "需求分析",
          "children": [
            {"data": {"text": "用户调研"}},
            {"data": {"text": "竞品分析"}},
            ...
          ]
        }
      },
      ...
    ]
  }
}
\`\`\`
```

### 示例 3: 优化内容

```
用户: 请简化这些节点,使其更简洁

AI: 我已将节点文本简化为关键词:

\`\`\`json
{
  "data": {
    "text": "项目管理",
    "children": [
      {"data": {"text": "需求"}},
      {"data": {"text": "设计"}},
      {"data": {"text": "开发"}},
      {"data": {"text": "测试"}},
      {"data": {"text": "部署"}}
    ]
  }
}
\`\`\`
```

## 🎯 AI 助手能力

### 支持的操作
- ✅ 创建完整的思维导图
- ✅ 添加新节点
- ✅ 删除节点
- ✅ 重组层级结构
- ✅ 优化节点文本
- ✅ 扩展内容细节
- ✅ 精简冗余内容
- ✅ 调整节点顺序
- ✅ 生成多种主题的思维导图

### 数据格式规范
AI 生成的 JSON 必须符合以下格式:
```json
{
  "data": {
    "text": "中心主题",
    "children": [
      {
        "data": {
          "text": "子主题",
          "children": []
        }
      }
    ]
  }
}
```

### 输出要求
1. 完整的 JSON 结构,无省略
2. 可被 `JSON.parse()` 直接解析
3. 使用 `\`\`\`json` 代码块包裹
4. 层级不超过 5 层
5. 节点文本简洁(建议不超过 20 字)

## 🔧 技术实现

### 前端组件
- `prompts/mindmap-prompts.ts` - 提示词模板和工具函数
- `store/aiStore.ts` - AI 状态管理(含思维导图剪贴板)
- `components/Editors/MindMapEditor.tsx` - 思维导图编辑器
- `components/Note/NoteEditor.tsx` - 笔记编辑器(自动切换助手)

### 核心函数
```typescript
// 发送思维导图数据到 AI
sendMindmapToAI(fullData, selectedNodes?, selectedPath?)

// 从 AI 响应中提取 JSON
importMindmapFromClipboard()

// 验证 JSON 结构
validateMindMapJSON(json)

// 提取 AI 响应中的 JSON
extractMindMapJSONFromResponse(response)
```

### 数据流
```
思维导图编辑器
    ↓ (发送数据)
aiStore.sendMindmapToAI()
    ↓ (格式化数据)
AI 助手接收
    ↓ (AI 处理)
AI 生成 JSON 响应
    ↓ (提取 JSON)
aiStore.importMindmapFromClipboard()
    ↓ (加载到编辑器)
思维导图更新
```

## 📝 注意事项

### 使用建议
1. **明确需求**: 向 AI 描述需求时要清晰具体
2. **逐步优化**: 可以多次迭代,逐步完善思维导图
3. **保存备份**: 重要修改前建议先保存当前版本
4. **验证结果**: 导入后检查思维导图结构是否符合预期

### 错误处理
- 如果 JSON 格式错误,AI 会指出问题并请求修正
- 如果导入失败,会显示具体的错误信息
- 可以手动复制 JSON 到剪贴板,然后使用导入功能

### 性能考虑
- 大型思维导图(超过 100 个节点)可能需要较长处理时间
- AI 响应时间取决于模型配置和网络状况
- 建议分批处理复杂的修改需求

## 🎓 最佳实践

### 1. 创建思维导图的提示词
```
"创建一个关于[主题]的思维导图,包含[具体要求]"
例如: "创建一个关于产品发布流程的思维导图,包含策划、开发、测试、上线四个阶段"
```

### 2. 优化思维导图的提示词
```
"优化[具体节点],使其[优化目标]"
例如: "优化需求分析节点,添加更详细的子节点"
```

### 3. 重组结构的提示词
```
"将[节点]按[规则]重新组织"
例如: "将功能列表按优先级重新排序,高优先级放在前面"
```

## 🔍 故障排除

### 问题 1: AI 助手没有自动切换
**解决方案**: 手动在 AI 助手下拉列表中选择"思维导图助手"

### 问题 2: 导入失败
**解决方案**:
- 检查 AI 是否生成了有效的 JSON 代码块
- 确保 JSON 格式正确,没有语法错误
- 查看控制台错误日志获取详细信息

### 问题 3: 节点发送失败
**解决方案**:
- 确保已选中至少一个节点
- 检查思维导图数据是否有效
- 刷新页面重试

### 问题 4: JSON 结构错误
**解决方案**:
- 让 AI 重新生成,强调格式要求
- 手动修复 JSON 中的语法错误
- 使用 JSON 验证工具检查格式

## 📚 相关文档

- [思维导图编辑器使用指南](./EDITOR_GUIDE.md)
- [AI 助手配置说明](./AI_ASSISTANTS.md)
- [JSON 格式规范](https://www.json.org/)
- [simple-mind-map 文档](https://wanglin2.github.io/mind-map/)
