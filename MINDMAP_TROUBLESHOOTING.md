# 思维导图 AI 助手 - 故障排除指南

## 🔧 常见问题及解决方案

### 问题 1: AI 生成了内容,但"从 AI 导入"失败

**症状**: 
- AI 助手显示了思维导图 JSON
- 点击"从 AI 导入"提示"导入失败"
- 控制台显示"未找到有效的JSON内容"

**原因分析**:
1. AI 可能没有使用正确的代码块格式
2. JSON 代码块可能使用了不标准的标记
3. 响应中可能包含其他文本干扰

**解决方案**:

#### 方案 A: 使用"粘贴导入"(推荐)
这是最可靠的方式,适用于所有情况:

```
1. 在 AI 助手中找到生成的 JSON
2. 手工复制完整的 JSON 代码(包括 ```json 和 ``` 标记)
3. 点击思维导图工具栏的"粘贴导入"按钮
4. 系统会自动提取和导入
```

#### 方案 B: 只复制 JSON 部分
```
1. 只复制 JSON 数据本身(不包括 ```json 标记)
2. 点击"粘贴导入"
3. 系统会自动识别和导入
```

#### 方案 C: 重新生成
如果 AI 没有使用代码块格式,可以重新要求:
```
请用 ```json 代码块格式重新输出
```

### 问题 2: AI 生成的 JSON 格式不正确

**症状**:
- 导入时提示"JSON格式错误"
- 或者提示"数据结构验证失败"

**解决方案**:

#### 检查 JSON 结构
确保 AI 生成的 JSON 包含必需的结构:
```json
{
  "data": {
    "text": "中心主题",
    "children": []
  }
}
```

#### 常见错误和修复
| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| 缺少必需的 data 字段 | 没有 data 包装 | 让 AI 重新生成,强调需要 data 包装 |
| 缺少必需的 data.text 字段 | 根节点没有 text | 添加中心主题文本 |
| children 必须是数组 | children 不是数组格式 | 检查并修正为 [] |

#### 重新提示 AI
```
你生成的JSON格式不正确,请使用以下格式:
{
  "data": {
    "text": "中心主题",
    "children": [...]
  }
}
```

### 问题 3: 无法访问剪贴板

**症状**:
- 点击"粘贴导入"提示"无法访问剪贴板"
- 或者"请授予权限"

**解决方案**:

#### 浏览器权限设置
1. 点击浏览器地址栏的锁图标
2. 找到"剪贴板"权限
3. 设置为"允许"
4. 刷新页面重试

#### 替代方案
如果无法授予权限,可以:
1. 使用"从 AI 导入"功能
2. 或者手工导入文件

### 问题 4: AI 没有生成完整的 JSON

**症状**:
- JSON 中有 "..." 或省略号
- 或者提示"内容过长,已截断"

**解决方案**:

#### 分批生成
```
请先生成前 3 个分支的完整JSON
```
然后再:
```
请继续生成后 3 个分支的完整JSON
```

#### 明确要求完整输出
```
请生成完整的思维导图JSON,不要有任何省略或截断
```

### 问题 5: 导入后节点丢失

**症状**:
- JSON 导入成功
- 但部分节点没有显示

**解决方案**:

#### 检查层级结构
确保 children 数组正确嵌套:
```json
{
  "data": {
    "text": "中心",
    "children": [
      {
        "data": {
          "text": "子节点1",
          "children": []  // 确保有这个字段
        }
      }
    ]
  }
}
```

#### 检查节点数量
如果节点过多(>100),考虑分批导入

## 🎯 快速诊断流程

### 步骤 1: 确认 AI 是否生成了内容
- ✅ AI 响应中有 JSON 代码块
- ❌ 重新输入提示词

### 步骤 2: 复制 JSON 内容
- ✅ 手工复制完整的 JSON(包括 ``` 标记)
- ❌ 如果没有 JSON,要求 AI 重新生成

### 步骤 3: 使用"粘贴导入"
- ✅ 点击"粘贴导入"按钮
- ✅ 成功导入
- ❌ 继续下一步

### 步骤 4: 检查 JSON 格式
- ✅ 使用在线 JSON 验证工具
- ✅ 确认包含 data.text 和 children
- ❌ 让 AI 修正格式

### 步骤 5: 尝试直接导入
- ✅ 如果格式正确但仍失败
- ❌ 查看控制台错误信息

## 📋 调试检查清单

### AI 生成检查
- [ ] AI 是否输出了 JSON 代码块
- [ ] 代码块使用的是 ```json 标记
- [ ] JSON 完整(没有省略号)
- [ ] JSON 可以被在线工具验证

### JSON 结构检查
- [ ] 包含 data 字段
- [ ] 包含 data.text 字段(中心主题)
- [ ] children 是数组类型
- [ ] 所有节点都有 data.text
- [ ] 层级结构正确嵌套

### 导入操作检查
- [ ] 复制了完整内容
- [ ] 点击了"粘贴导入"按钮
- [ ] 浏览器剪贴板权限已授予
- [ ] 控制台没有错误信息

### 思维导图显示检查
- [ ] 导入后画布有内容
- [ ] 中心主题显示正确
- [ ] 子节点数量正确
- [ ] 层级关系正确

## 🔍 高级调试

### 启用详细日志
打开浏览器控制台,查看详细日志:

```javascript
// 会显示以下日志:
[extractMindMapJSON] 开始提取JSON, 响应长度: XXX
[extractMindMapJSON] 找到json代码块, 长度: XXX
[extractMindMapJSON] 清理后的JSON前100字符: ...
[extractMindMapJSON] JSON提取成功
```

### 手动验证 JSON
使用在线工具验证:
- https://jsonlint.com/
- https://www.json.cn/

### 测试剪贴板权限
在控制台执行:
```javascript
navigator.clipboard.readText().then(text => {
  console.log("剪贴板内容长度:", text.length);
  console.log("前100字符:", text.substring(0, 100));
}).catch(err => {
  console.error("剪贴板访问失败:", err);
});
```

## 💡 最佳实践

### 提示词优化

**好的提示词**:
```
请创建一个关于"项目管理"的思维导图,用完整的JSON格式输出
```

**更好的提示词**:
```
请创建一个关于"项目管理"的思维导图,要求:
1. 使用完整的JSON格式
2. 用 ```json 代码块包裹
3. 包含5个主要分支
4. 每个分支有3-5个子节点
5. 不要有任何省略
```

### 工作流程建议

1. **先测试简单示例**
   - 从 3-5 个节点开始
   - 确保流程可行
   - 再处理复杂场景

2. **分批处理大型思维导图**
   - 先创建主要结构
   - 逐步添加细节
   - 定期保存

3. **使用"粘贴导入"作为主要方式**
   - 最可靠
   - 支持手工复制
   - 错误提示清晰

## 📞 获取帮助

如果以上方案都无法解决问题:

1. **收集信息**:
   - 截图 AI 的完整响应
   - 复制 JSON 内容
   - 记录控制台错误信息
   - 说明操作步骤

2. **检查环境**:
   - 浏览器版本
   - 是否在隐私模式
   - 剪贴板权限状态

3. **尝试替代方案**:
   - 使用不同的浏览器
   - 关闭隐私模式
   - 重启应用

---

## 🎓 成功案例参考

### 案例 1: 创建学习计划
```
用户: 创建一个关于"Python学习计划"的思维导图
AI: [生成JSON]
操作: 复制JSON → 点击"粘贴导入" → 成功
```

### 案例 2: 优化现有结构
```
用户: [选中节点] → 点击"发送到AI"
用户: 请为这些节点添加更多细节
AI: [生成优化后的JSON]
操作: 点击"从AI导入" → 成功
```

### 案例 3: 重组层级
```
用户: [选中多个节点]
用户: 请按重要性重新排序
AI: [生成重组后的JSON]
操作: 复制JSON → 点击"粘贴导入" → 成功
```

记住: **"粘贴导入"是最可靠的方式!** 🎉
