# 思维导图 AI 助手 - 使用说明

## 🎯 核心功能

思维导图 AI 助手已经集成到系统中,提供以下功能:

1. **自动切换助手** - 打开思维导图笔记时自动切换到思维导图助手
2. **发送数据到 AI** - 选中节点后发送给 AI 助手处理
3. **AI 生成/修改** - AI 可以创建、优化、重组思维导图
4. **从 AI 导入** - 将 AI 生成的 JSON 导入到编辑器
5. **粘贴导入** - 手工复制 JSON 后导入(备用方案)

## 🚀 快速开始

### 步骤 1: 创建思维导图笔记

1. 点击"创建笔记"
2. 选择文件类型为"思维导图"
3. AI 助手会自动切换到"思维导图助手"

### 步骤 2: 让 AI 创建思维导图

在 AI 助手中输入:
```
帮我创建一个关于"项目计划"的思维导图,包含:
- 需求分析
- 设计阶段
- 开发实现
- 测试验收
- 上线部署
```

### 步骤 3: 导入到编辑器

**方式 1: 从 AI 导入** (推荐)
- 等待 AI 生成完成
- 点击思维导图工具栏的"从 AI 导入"按钮
- 系统自动提取并导入

**方式 2: 粘贴导入** (备用)
1. 在 AI 助手中找到生成的 JSON 代码块
2. 手工复制(包括 ```json 标记)
3. 点击"粘贴导入"按钮
4. 系统自动识别并导入

## 📝 常见操作

### 创建思维导图

```
创建一个关于[主题]的思维导图
```

示例:
```
创建一个关于"Python学习路线"的思维导图,包含基础、进阶、实战三个方向
```

### 优化现有思维导图

1. 选中需要优化的节点
2. 点击"发送到 AI 助手"
3. 描述优化需求

示例:
```
请为这些节点添加更详细的子节点
```

### 扩展内容

```
请为[某节点]添加 5 个具体的子节点
```

### 简化内容

```
请将这些节点的文本简化为关键词
```

### 重组结构

```
请按[规则]重新组织这些节点
```

示例:
```
请按重要性重新排序,最重要的放在最前面
```

## 🔧 导入方式对比

| 方式 | 优点 | 缺点 | 适用场景 |
|-----|------|------|---------|
| **从 AI 导入** | 自动化,无需复制 | 需要AI格式完全正确 | AI首次生成 |
| **粘贴导入** | 最可靠,容错性强 | 需要手工复制 | 所有场景,特别是重试 |

## ⚠️ 故障排除

### 问题: "从 AI 导入"提示没有内容

**原因**: AI 生成完成后,`currentResponse` 状态被清空

**解决方案**:
1. 使用"粘贴导入"功能(推荐)
2. 或者查看对话历史,AI的响应已保存

### 问题: JSON 格式错误

**检查**:
- AI 是否使用了 ```json 代码块
- JSON 结构是否完整
- 是否包含 data.text 和 children

**解决**: 重新让 AI 生成,强调格式要求:
```
请用标准的 JSON 格式输出,使用 ```json 代码块包裹
```

### 问题: 导入后节点丢失

**检查**:
- JSON 中的 children 是否为数组
- 是否有语法错误导致部分节点未解析

**解决**: 使用在线 JSON 工具验证格式

## 🎓 最佳实践

### 1. 使用清晰的提示词

✅ 好的提示词:
```
创建一个关于"Web开发"的思维导图,包含前端、后端、数据库三个部分,每部分3-5个子节点
```

❌ 不好的提示词:
```
创建一个思维导图
```

### 2. 分步处理复杂需求

对于复杂的思维导图:
```
第1步: 先创建主要分支
第2步: 为每个分支添加子节点
第3步: 进一步细化细节
```

### 3. 优先使用"粘贴导入"

- 最可靠
- 支持手工复制的任何内容
- 错误提示更清晰

### 4. 保存中间版本

重要修改前:
1. 导出当前版本
2. 再让 AI 修改
3. 对比效果

## 📊 数据流程

```
用户输入需求
    ↓
AI 生成 JSON
    ↓
用户查看响应
    ↓
┌─────────────┬──────────────┐
│ 从 AI 导入  │  粘贴导入     │
│ (自动化)    │  (手工复制)   │
└─────────────┴──────────────┘
         ↓
    提取 JSON
         ↓
    验证格式
         ↓
    加载到编辑器
         ↓
    保存到笔记
```

## 🔍 调试技巧

### 启用调试日志

打开浏览器控制台(F12),可以看到详细日志:

```
[AIStore] importMindmapFromClipboard 被调用
[AIStore] 从对话历史获取AI响应, 消息索引: X
[AIStore] 准备提取JSON, 响应长度: XXX
[extractMindMapJSON] 找到json代码块, 长度: XXX
[extractMindMapJSON] JSON提取成功
```

### 验证 JSON 格式

使用在线工具:
- https://jsonlint.com/
- https://www.json.cn/

### 测试剪贴板

在控制台执行:
```javascript
navigator.clipboard.readText().then(text => {
  console.log("剪贴板内容:", text.substring(0, 100));
});
```

## 💡 高级技巧

### 1. 组合多种操作

```
先创建一个关于"产品发布"的思维导图,
然后为每个阶段添加时间节点,
最后按优先级重新排序
```

### 2. 迭代优化

```
第1次: 创建基本结构
第2次: 添加细节
第3次: 优化文本
第4次: 调整布局
```

### 3. 使用模板

保存常用的思维导图模板:
- 项目管理
- 学习计划
- 会议议程
- 产品规划

## 🎉 成功案例

### 案例 1: 创建学习计划

**输入**:
```
创建一个"前端开发学习计划"思维导图
```

**AI 生成**: 包含 HTML、CSS、JavaScript、框架等分支

**导入**: 点击"从 AI 导入"

**结果**: 完整的学习路线图

### 案例 2: 优化现有结构

**操作**:
1. 选中"技术栈"节点
2. 发送到 AI
3. 输入: "请添加具体的技术点"

**结果**: 该节点下添加了详细的技术列表

### 案例 3: 重组内容

**操作**:
1. 选中多个功能节点
2. 发送到 AI
3. 输入: "按开发优先级重新排序"

**结果**: 节点按优先级重新排列

---

## 📞 需要帮助?

如果遇到问题:

1. **查看控制台日志** - 了解详细的错误信息
2. **使用"粘贴导入"** - 这是最可靠的方式
3. **验证 JSON 格式** - 使用在线工具检查
4. **参考故障排除文档** - MINDMAP_TROUBLESHOOTING.md

记住: **"粘贴导入"是万能的备用方案!** 🎯
